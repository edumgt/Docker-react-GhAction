(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&l(v)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const i=document.getElementById("backgroundCanvas"),s=i.getContext("2d"),c=document.getElementById("drawingCanvas"),n=c.getContext("2d"),b=document.getElementById("gridToggle"),B=document.getElementById("colorPicker"),L=document.getElementById("brushSize"),$=document.getElementById("toolSelect"),h=document.getElementById("savedSvgSelect"),P=document.getElementById("saveSvgServerBtn"),N=document.getElementById("refreshSvgListBtn"),G=document.getElementById("loadSvgBtn"),E=document.getElementById("statusText");let m=!1,u=0,f=0,w=B.value,p=Number(L.value),d="pen",C=!1;function g(e,t=!1){E.textContent=e,E.className=t?"text-xs text-red-600":"text-xs text-slate-600"}function I(){const e=window.innerWidth-40,t=window.innerHeight-150;i.width=c.width=e,i.height=c.height=t,y()}function O(e=25){s.strokeStyle="#e0e0e0",s.lineWidth=1;for(let t=0;t<i.width;t+=e)s.beginPath(),s.moveTo(t,0),s.lineTo(t,i.height),s.stroke();for(let t=0;t<i.height;t+=e)s.beginPath(),s.moveTo(0,t),s.lineTo(i.width,t),s.stroke()}function y(){s.fillStyle="#ffffff",s.fillRect(0,0,i.width,i.height),C&&O()}function T(){const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=i.width,e.height=i.height,t.drawImage(i,0,0),t.drawImage(c,0,0),e.toDataURL("image/png")}function V(){const e=T(),t=i.width,r=i.height;return`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${r}" viewBox="0 0 ${t} ${r}">
  <image width="100%" height="100%" href="${e}" />
</svg>`}function x(e="png"){const t=document.createElement("a");t.download=`drawing.${e}`,t.href=T().replace("image/png",`image/${e}`),t.click()}async function S(){try{const e=await fetch("/api/svgs");if(!e.ok)throw new Error("목록 조회 실패");const t=await e.json();h.innerHTML='<option value="">저장된 SVG 선택</option>',t.files.forEach(r=>{const l=document.createElement("option");l.value=r,l.textContent=r,h.appendChild(l)}),g(`SVG ${t.files.length}개를 불러왔습니다.`)}catch(e){g(`SVG 목록 조회 실패: ${e.message}`,!0)}}async function z(){const e=V();try{const t=await fetch("/api/svgs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({svgContent:e})});if(!t.ok)throw new Error("저장 실패");const r=await t.json();g(`저장 완료: ${r.fileName}`),await S(),h.value=r.fileName}catch(t){g(`서버 저장 실패: ${t.message}`,!0)}}function k(){n.clearRect(0,0,c.width,c.height)}async function D(){const e=h.value;if(!e){g("불러올 SVG를 선택해 주세요.",!0);return}try{const t=new Image;t.onload=()=>{k(),y(),n.drawImage(t,0,0,c.width,c.height),g(`불러오기 완료: ${e}`)},t.onerror=()=>{g(`SVG 이미지 렌더링 실패: ${e}`,!0)},t.src=`/api/svgs/${e}?t=${Date.now()}`}catch(t){g(`SVG 불러오기 실패: ${t.message}`,!0)}}window.addEventListener("resize",I);I();b.addEventListener("change",e=>{C=e.target.checked,y()});c.addEventListener("mousedown",e=>{m=!0,u=e.offsetX,f=e.offsetY,(d==="pen"||d==="eraser")&&(n.beginPath(),n.moveTo(u,f))});c.addEventListener("mousemove",e=>{m&&(d==="pen"||d==="eraser")&&(n.lineWidth=p,n.lineCap="round",n.strokeStyle=d==="eraser"?"#ffffff":w,n.lineTo(e.offsetX,e.offsetY),n.stroke())});c.addEventListener("mouseup",e=>{if(!m)return;m=!1;const t=e.offsetX,r=e.offsetY;if(n.lineWidth=p,n.strokeStyle=w,d==="line")n.beginPath(),n.moveTo(u,f),n.lineTo(t,r),n.stroke();else if(d==="rect")n.strokeRect(u,f,t-u,r-f);else if(d==="circle"){const l=Math.hypot(t-u,r-f);n.beginPath(),n.arc(u,f,l,0,Math.PI*2),n.stroke()}});B.addEventListener("input",e=>{w=e.target.value});L.addEventListener("input",e=>{p=Number(e.target.value)});$.addEventListener("change",e=>{d=e.target.value});document.getElementById("clearBtn").addEventListener("click",k);document.getElementById("savePngBtn").addEventListener("click",()=>x("png"));document.getElementById("saveJpgBtn").addEventListener("click",()=>x("jpeg"));P.addEventListener("click",z);N.addEventListener("click",S);G.addEventListener("click",D);S();
